CC = gcc
CFLAGS = -Wall -g -fPIC
NICO_LIB = /home/pn-cs453/Given/Asgn1

all: malloc hello
    
libmalloc.so: malloc.o linkedlist.o
	    $(CC) $(CFLAGS) -shared -o libmalloc.so malloc.o linkedlist.o

malloc.o: malloc.c
	    $(CC) $(CFLAGS) -c malloc.c -I$(NICO_LIB) -L$(NICO_LIB)/lib64

malloc: libmalloc.so
	    @echo "Libraries built."

linkedlist.o: linkedlist.c
		$(CC) $(CFLAGS) -c linkedlist.c -I$(NICO_LIB) -L$(NICO_LIB)/lib64


intel-all: lib/libmalloc.so lib64/libmalloc.so

lib/libmalloc.so: lib malloc32.o linkedlist32.o
	    $(CC) $(CFLAGS) -m32 -shared -o $@ malloc32.o linkedlist32.o

lib64/libmalloc.so: lib64 malloc64.o linkedlist64.o
	    $(CC) $(CFLAGS) -shared -o $@ malloc64.o linkedlist64.o
		    

linkedlist32.o: linkedlist.c
	    $(CC) $(CFLAGS) -m32 -c -o linkedlist32.o linkedlist.c
		
linkedlist64.o:
	    $(CC) $(CFLAGS) -m64 -c -o linkedlist64.o linkedlist.c

malloc32.o: malloc.c
	    $(CC) $(CFLAGS) -m32 -c -o malloc32.o malloc.c

malloc64.o: malloc.c
	    $(CC) $(CFLAGS) -m64 -c -o malloc64.o malloc.c

hello: hello.o libmalloc.so
	    $(CC) -L./ -Wl,-rpath=./ -L$(NICO_LIB)/lib64 -o hello hello.o -lmalloc -lplnprint

hello.o: hello.c
	    $(CC) -Wall -g -c hello.c -I$(NICO_LIB) -L$(NICO_LIB)/lib64

lib:
	    mkdir lib

lib64:
	    mkdir lib64

clean:
	    rm -f *.o *.a *.so hello
		rm -rf lib lib64
